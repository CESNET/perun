<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<context:property-placeholder properties-ref="coreProperties" ignore-unresolvable="true"/>

	<!-- type-safe configuration -->
	<bean id="coreConfig" class="cz.metacentrum.perun.core.api.CoreConfig" init-method="initBeansUtils">
		<property name="properties" ref="coreProperties"/>
		<property name="admins" value="#{'${perun.admins}'.split('\s*,\s*')}"/>
		<property name="alternativePasswordManagerProgram" value="${perun.alternativePasswordManager.program}"/>
		<property name="dbInitializatorEnabled" value="${perun.DBInitializatorEnabled}"/>
		<property name="dbType" value="${perun.db.type}"/>
		<property name="dontLookupUsers" value="#{'${perun.dont.lookup.users}'.split('\s*,\s*')}"/>
		<property name="enginePrincipals" value="#{'${perun.engine.principals}'.split('\s*,\s*')}"/>
		<property name="generatedLoginNamespaces" value="#{'${perun.loginNamespace.generated}'.split('\s*,\s*')}"/>
		<property name="userSynchronizationTimeout" value="${perun.user.synchronization.timeout}"/>
		<property name="userMaxConcurentUsersToSynchronize" value="${perun.user.maxConcurentUsersToSynchronize}"/>
		<property name="extSourceSynchronizationTimeout" value="${perun.extSource.synchronization.timeout}"/>
		<property name="extSourceMaxConcurentExtSourcesToSynchronize" value="${perun.extSource.maxConcurentExtSourcesToSynchronize}"/>
		<property name="groupSynchronizationInterval" value="${perun.group.synchronization.interval}"/>
		<property name="groupSynchronizationTimeout" value="${perun.group.synchronization.timeout}"/>
		<property name="groupMaxConcurentGroupsToSynchronize" value="${perun.group.maxConcurentGroupsToSynchronize}"/>
		<property name="instanceId" value="${perun.instanceId}"/>
		<property name="instanceName" value="${perun.instanceName}"/>
		<property name="mailchangeBackupFrom" value="${perun.mailchange.backupFrom}"/>
		<property name="mailchangeSecretKey" value="${perun.mailchange.secretKey}"/>
		<property name="mailchangeValidationWindow" value="${perun.mailchange.validationWindow}"/>
		<property name="nativeLanguage" value="${perun.native.language}"/>
		<property name="notificationPrincipals" value="#{'${perun.notification.principals}'.split('\s*,\s*')}"/>
		<property name="passwordManagerProgram" value="${perun.passwordManager.program}"/>
		<property name="proxyIdPs" value="#{'${perun.proxyIdPs}'.split('\s*,\s*')}"/>
		<property name="pwdresetInitVector" value="${perun.pwdreset.initVector}"/>
		<property name="pwdresetSecretKey" value="${perun.pwdreset.secretKey}"/>
		<property name="pwdresetValidationWindow" value="${perun.pwdreset.validationWindow}"/>
		<property name="readOnlyPerun" value="${perun.readOnlyPerun}"/>
		<property name="recaptchaPrivateKey" value="${perun.recaptcha.privatekey}"/>
		<property name="registrarPrincipals" value="#{'${perun.registrar.principals}'.split('\s*,\s*')}"/>
		<property name="rpcPowerusers" value="#{'${perun.rpc.powerusers}'.split('\s*,\s*')}"/>
		<property name="rpcPrincipal" value="${perun.rpc.principal}"/>
		<property name="rtDefaultQueue" value="${perun.rt.defaultQueue}"/>
		<property name="rtServiceuserPassword" value="${perun.rt.serviceuser.password}"/>
		<property name="rtServiceuserUsername" value="${perun.rt.serviceuser.username}"/>
		<property name="rtUrl" value="${perun.rt.url}"/>
		<property name="smsProgram" value="${perun.sms.program}"/>
		<property name="userExtSourcesPersistent" value="${perun.userExtSources.persistent}"/>
		<property name="attributesForUpdateIdP" value="#{'${perun.attributesForUpdate.idp}'.split('\s*,\s*')}"/>
		<property name="attributesForUpdateX509" value="#{'${perun.attributesForUpdate.x509}'.split('\s*,\s*')}"/>
		<property name="oidcIssuers" value="#{'${perun.oidc.issuers}'.split('\s*,\s*')}"/>
		<property name="allowedCorsDomains" value="#{'${perun.allowedCorsDomains}'.split('\s*,\s*')}" />
		<property name="cacheEnabled" value="${perun.cacheEnabled}" />
		<property name="pdfFontPath" value="${perun.pdfFontPath}" />
	</bean>






	<!-- Properties Bean for perun-core -->

	<bean id="defaultCoreProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
		<property name="properties">
			<props>
				<prop key="perun.instanceName">Perun</prop>
				<prop key="perun.admins">perunTests, perunController, perunEngine, perunDispatcher, perunRegistrar,
					perunSynchronizer, perunCabinet
				</prop>
				<prop key="perun.engine.principals">perunEngine</prop>
				<prop key="perun.registrar.principals"/>
				<prop key="perun.notification.principals">perunNotifications</prop>
				<prop key="perun.rpc.principal">perunRpc</prop>
				<prop key="perun.dont.lookup.users">perunTests, perunController, perunEngine, perunDispatcher,
					perunRegistrar, perunSynchronizer, perunCabinet, perunNotifications, perunRpc, perunLdapc,
					perunLdapInitializer
				</prop>
				<prop key="perun.db.type">hsqldb</prop>
				<prop key="perun.user.synchronization.timeout">1</prop>
				<prop key="perun.user.maxConcurentUsersToSynchronize">10</prop>
				<prop key="perun.extSource.synchronization.timeout">120</prop>
				<prop key="perun.extSource.maxConcurentExtSourcesToSynchronize">2</prop>
				<prop key="perun.group.synchronization.interval">1</prop>
				<prop key="perun.group.synchronization.timeout">10</prop>
				<prop key="perun.group.maxConcurentGroupsToSynchronize">10</prop>
				<prop key="perun.rpc.powerusers"/>
				<prop key="perun.perun.db.name">perun</prop>
				<prop key="perun.rt.url">https://rt3.cesnet.cz/rt/REST/1.0/ticket/new</prop>
				<prop key="perun.rt.defaultQueue">perun</prop>
				<prop key="perun.rt.serviceuser.username">perunv3-rt</prop>
				<prop key="perun.rt.serviceuser.password">password</prop>
				<prop key="perun.passwordManager.program">/usr/local/bin/perun.passwordManager</prop>
				<prop key="perun.alternativePasswordManager.program">/usr/local/bin/perun.altPasswordManager</prop>
				<prop key="perun.recaptcha.privatekey"/>
				<prop key="perun.mailchange.secretKey"/>
				<prop key="perun.mailchange.backupFrom"/>
				<prop key="perun.mailchange.validationWindow">6</prop>
				<prop key="perun.pwdreset.secretKey">jda3ufK92DKs2335af</prop>
				<prop key="perun.pwdreset.initVector">2Akd14k3o9s1d2G5</prop>
				<prop key="perun.pwdreset.validationWindow">6</prop>
				<prop key="perun.native.language">cs,ÄŒesky,Czech</prop>
				<prop key="perun.loginNamespace.generated"/>
				<prop key="perun.sms.program"/>
				<prop key="perun.readOnlyPerun">false</prop>
				<prop key="perun.DBInitializatorEnabled">false</prop>
				<prop key="perun.userExtSources.persistent">PERUN,[\w\d]*</prop>
				<prop key="perun.proxyIdPs"/>
				<prop key="perun.attributesForUpdate.idp">mail,cn,sn,givenName,o,ou,eppn,affiliation,displayName,uid,epuid,schacHomeOrganization,forwardedScopedAffiliation,alternativeLoginName,isCesnetEligibleLastSeen,IdPOrganizationName,sourceIdPName</prop>
				<prop key="perun.attributesForUpdate.x509">mail,cn,o,dn,cadn,certificate</prop>
				<prop key="perun.instanceId">AOJ26J3D9DCK3OA7</prop>
				<prop key="perun.instanceName">LOCAL</prop>
				<prop key="perun.allowedCorsDomains"></prop>
				<prop key="perun.cacheEnabled">false</prop>
				<!--
				   this creates a map from OIDC issuer to user extsources that are used for looking up a user identified by "sub" claim
				-->
				<prop key="perun.oidc.issuers">i1,i2,i3,i4</prop>
				<prop key="perun.oidc.i1.iss">https://perun-dev.meta.zcu.cz/oidc/</prop>
				<prop key="perun.oidc.i1.extsource.name">PERUN</prop>
				<prop key="perun.oidc.i1.extsource.type">cz.metacentrum.perun.core.impl.ExtSourceSqlComplex</prop>
				<prop key="perun.oidc.i2.iss">https://login.cesnet.cz/oidc/</prop>
				<prop key="perun.oidc.i2.extsource.name">https://login.cesnet.cz/idp/</prop>
				<prop key="perun.oidc.i2.extsource.type">cz.metacentrum.perun.core.impl.ExtSourceIdp</prop>
				<prop key="perun.oidc.i3.iss">https://auth.west-life.eu/oidc/</prop>
				<prop key="perun.oidc.i3.extsource.name">https://auth.west-life.eu/proxy/saml2/idp/metadata.php</prop>
				<prop key="perun.oidc.i3.extsource.type">cz.metacentrum.perun.core.impl.ExtSourceIdp</prop>
				<prop key="perun.oidc.i4.iss">https://login.elixir-czech.org/oidc/</prop>
				<prop key="perun.oidc.i4.extsource.name">https://login.elixir-czech.org/idp/</prop>
				<prop key="perun.oidc.i4.extsource.type">cz.metacentrum.perun.core.impl.ExtSourceIdp</prop>

			</props>
		</property>
	</bean>

	<!-- active in Spring profile "production", packs default properties with properties from files as a bean -->
	<beans profile="production">
		<bean id="coreProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
			<property name="properties" ref="defaultCoreProperties"/>
			<property name="locations">
				<list>
					<value>file:@perun.conf@perun.properties</value>
					<value>file:${perun.conf.custom}perun.properties</value>
				</list>
			</property>
			<property name="ignoreResourceNotFound" value="true"/>
		</bean>
	</beans>

	<!-- active in Spring profile "default", packs default properties and few others as a bean -->
	<beans profile="default">
		<bean id="coreProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
			<property name="properties" ref="defaultCoreProperties"/>
		</bean>
	</beans>

</beans>
