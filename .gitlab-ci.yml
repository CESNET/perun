include:
  - project: perun/common
    file: /templates/.gitlab-ci-template.yml

variables:
  # release from production branch instead of main
  RELEASE_FROM_PRODUCTION: 1

# build and run tests
maven-build:
  image: registry.gitlab.ics.muni.cz:443/perun-proxy-aai/containers/ci-tools/perun-idm-builder:latest@sha256:cfe489638b536eb4dede6011a7fc0280f39f7fb0d0dc7c6d5722e466993337b4
  stage: build
  tags: # do not run on k8s
    - docker
    - privileged
  script:
    - mvn -B -Dmaven.repo.local=.m2/repository clean install
  rules:
    - if: "$CI_PIPELINE_SOURCE != 'schedule'"
